- name: Install ansible as a dependency
  hosts: all
  become: true
  roles:
    - FGtatsuro.ansible

- name: Restore my comphy laptop environment
  hosts: all

  vars:
    home_dir: "/home/{{ lookup('env','USER') }}"

  tasks:
    - name: Show me the home dir
      shell: echo {{ home_dir }}

    - name: Install base applications.
      apt: pkg={{item}} update_cache=yes state=latest
      with_items:
        - adobe-flashplugin
        - glances

    - name: Set monitor timeout
      shell: dbus-launch dconf write /org/gnome/desktop/session/idle-delay 600

    - name: Set screen lock
      shell: dbus-launch dconf write /org/gnome/desktop/screensaver/lock-enabled true

    - name: Set screen delay
      shell: dbus-launch dconf write /org/gnome/desktop/screensaver/lock-delay 1800

    - name: Map keyboard caps to ctrl
      replace:
        path: /etc/default/keyboard
        regexp: 'XKBOPTIONS=""'
        replace: 'XKBOPTIONS="ctrl:nocaps"'
      become: true

      # sudo dpkg-reconfigure keyboard-configuration


  roles:
    # tags: focus # ./focus.sh

    - role: roles/dnscrypt-proxy
    - role: roles/dropbox
    - role: roles/ruby
    - role: roles/bash-it
    - role: roles/flux
    - role: roles/git
    - role: roles/shortcuts
    - role: roles/vim

    - role: ANXS.postgresql
      postgresql_version: 9.6
      postgresql_users:
        - name: "{{ lookup('env','USER') }}"
      postgresql_user_privileges:
        - name: "{{ lookup('env','USER') }}"
          priv: "ALL"
          db: postgres
          role_attr_flags: "CREATEDB"
      postgresql_ext_install_dev_headers: yes
      become: true

    - role: FGtatsuro.vagrant
      become: true

    - role: bearandgiraffe.heroku-cli
      become: true

    - role: cmprescott.chrome
      become: true

    - role: rdeknijf.chromedriver
      tags: focus
      become: true

    - role: jpnewman.redis
      become: true

    # Not happy on re-runs :-(
    # - role: iknite.spotify
    #   become: true
